base <- read.csv('../models/HGAC-RSPM-TAZ/inputs/bzone_dwelling_units_2045.csv')[Year==2019]
base <- read.csv('../models/HGAC-RSPM-TAZ/inputs/bzone_dwelling_units_2045.csv')[Year==2019]
base <- read.csv('../models/HGAC-RSPM-TAZ/inputs/bzone_dwelling_units.csv')[Year==2019]
base <- read.csv('../models/HGAC-RSPM-TAZ/inputs/bzone_dwelling_units.csv')[base$Year==2019]
base <- read.csv('../models/HGAC-RSPM-TAZ/inputs/bzone_dwelling_units.csv')
print(base)
print(base[Year==2019])
print(base[base$Year==2019])
print(base$Year)
print(base$Year==2019)
print(base[base$Year==2019])
print(base$Year==2019)
print(base[base$Year==2019])
input[SFDU=1]
input <- read.csv('bzone_dwelling_units_2045.csv')
input[SFDU=1]
input[input$SFDU=1]
input[input$SFDU==1]
input[input$SFDU==1,]
base <- read.csv('../models/HGAC-RSPM-TAZ/inputs/bzone_dwelling_units.csv')[Year==2019,]
base <- read.csv('../models/HGAC-RSPM-TAZ/inputs/bzone_dwelling_units.csv')[base$Year==2019,]
base
input <- read.csv('bzone_dwelling_units_2045.csv')
base <- read.csv('../models/HGAC-RSPM-TAZ/inputs/bzone_dwelling_units.csv')[base$Year==2019,]
increase_file <- read.csv('Bzone1aGalReloTAZs.csv')
decrease_file <- read.csv('GalvestonIsland1aDwellingUnits.csv')
taz_groupings <- read.csv('TOE_TAZ-BZONE.csv')
decrease_factor= 0.2
increase_list <- increase_file$NewTAZ_ID
decrease_list <- decrease_file$NewTAZ_ID
decrease_rows <- input$Geo %in% decrease_list
changes <- lapply(input[decrease_rows,c("SFDU","MFDU","GQDU")],function(x) decrease_factor*sum(x))
total_change_sf = changes$SFDU
total_change_mf = changes$MFDU
total_change_gq = changes$GQDU
increase_rows <- input$Geo %in% increase_list
initial <- lapply(input[increase_rows,c("SFDU","MFDU","GQDU")],sum)
increase_factor <- mapply(function(change,initial) change/initial, changes, initial)
increase_factor[increase_factor == Inf] = 0 # Replace any Inf with zero in the increase factor
# increase_factor is then a list with elements c("SFDU","MFDU","GQDU") each of which is the corresponding factor
increase_factor <- as.data.frame(t(increase_factor))
# Changing dwelling units in increase_rows and decrease_rows vectors
print(increase_factor)
print(input)
input$SFDU[increase_rows] <- (1-increase_factor$SFDU)*input$SFDU[increase_rows]
input$MFDU[increase_rows] <- (1-increase_factor$MFDU)*input$MFDU[increase_rows]
input$GQDU[increase_rows] <- (1-increase_factor$GQDU)*input$GQDU[increase_rows]
input$SFDU[decrease_rows] <- (1-decrease_factor)*input$SFDU[decrease_rows]
input$MFDU[decrease_rows] <- (1-decrease_factor)*input$MFDU[decrease_rows]
input$GQDU[decrease_rows] <- (1-decrease_factor)*input$GQDU[decrease_rows]
input$Bzone <- taz_groupings$Bzone
#aggregates input into dataframe
final <- aggregate(input[,c("SFDU","MFDU","GQDU")],by=list(Geo=taz_groupings$Bzone),sum)
input
#aggregates input into dataframe
final <- aggregate(input[,c("Year","SFDU","MFDU","GQDU")],by=list(Geo=taz_groupings$Bzone),sum)
#Adding 3 sfdu to rows with 0 units
zero_rows <- input[sum(input$SFDU+input$MFDU+input$GQDU)==0]$Bzone
final$SFDU[zero_rows] <- 3
#prints output: run to view dataframe before exporting
print(final)
# NOTE: final$Geo is now an R factor, but we can change it back like this
#   final$Geo <- as.character(final$Geo)
# We don't need to do that if we're just writing it to .csv (as.character is the default column processing)
length(final)
# NOTE: final$Geo is now an R factor, but we can change it back like this
#   final$Geo <- as.character(final$Geo)
# We don't need to do that if we're just writing it to .csv (as.character is the default column processing)
dim(final)
length(final)
dim(base)
dim(base[Year==2019,])
dim(base[base$Year==2019,])
final <- rbind(base[base$Year==2019,],final)
dim(final)
input <- read.csv('bzone_dwelling_units_2045.csv')
base <- read.csv('../models/HGAC-RSPM-TAZ/inputs/bzone_dwelling_units.csv')[base$Year==2019,]
increase_file <- read.csv('Bzone1aGalReloTAZs.csv')
decrease_file <- read.csv('GalvestonIsland1aDwellingUnits.csv')
taz_groupings <- read.csv('TOE_TAZ-BZONE.csv')
decrease_factor= 0.2
increase_list <- increase_file$NewTAZ_ID
decrease_list <- decrease_file$NewTAZ_ID
decrease_rows <- input$Geo %in% decrease_list
changes <- lapply(input[decrease_rows,c("SFDU","MFDU","GQDU")],function(x) decrease_factor*sum(x))
total_change_sf = changes$SFDU
total_change_mf = changes$MFDU
total_change_gq = changes$GQDU
increase_rows <- input$Geo %in% increase_list
initial <- lapply(input[increase_rows,c("SFDU","MFDU","GQDU")],sum)
increase_factor <- mapply(function(change,initial) change/initial, changes, initial)
increase_factor[increase_factor == Inf] = 0 # Replace any Inf with zero in the increase factor
# increase_factor is then a list with elements c("SFDU","MFDU","GQDU") each of which is the corresponding factor
increase_factor <- as.data.frame(t(increase_factor))
input$SFDU[increase_rows] <- (1-increase_factor$SFDU)*input$SFDU[increase_rows]
input$MFDU[increase_rows] <- (1-increase_factor$MFDU)*input$MFDU[increase_rows]
input$GQDU[increase_rows] <- (1-increase_factor$GQDU)*input$GQDU[increase_rows]
input$SFDU[decrease_rows] <- (1-decrease_factor)*input$SFDU[decrease_rows]
input$MFDU[decrease_rows] <- (1-decrease_factor)*input$MFDU[decrease_rows]
input$GQDU[decrease_rows] <- (1-decrease_factor)*input$GQDU[decrease_rows]
input$Bzone <- taz_groupings$Bzone
#aggregates input into dataframe
final <- aggregate(input[,c("Year","SFDU","MFDU","GQDU")],by=list(Geo=taz_groupings$Bzone),sum)
#Adding 3 sfdu to rows with 0 units
zero_rows <- input[sum(input$SFDU+input$MFDU+input$GQDU)==0]$Bzone
final$SFDU[zero_rows] <- 3
print(final)
setdiff(base$Geo, final$Geo)
setdiff(final$Geo, base$Geo)
final[final$Geo==4911,]
final[base$Geo==4911,]
final[final$Geo==4911,]
#Adding 3 sfdu to rows with 0 units
zero_rows <- input[sum(input$SFDU+input$MFDU+input$GQDU)==0]$Bzone
final$SFDU[zero_rows] <- 3
final[final$Geo==4911,]
setdiff(final$Geo, base$Geo)
final[final$Geo==5151,]
final[base$Geo==5168,]
final[base$Geo==5151,]
setdiff(final$Geo, base$Geo)
#prints output: run to view dataframe before exporting
print(final)
zero_rows
#Adding 3 sfdu to rows with 0 units
zero_rows <- input[input$SFDU==0 & input$MFDU==0 & input$GQDU==0]$Bzone
input
#Adding 3 sfdu to rows with 0 units
zero_rows <- input[input$SFDU==0 & input$MFDU==0 & input$GQDU==0,]$Bzone
zero_rows
base
final
zero_rows_2 <- final[final$SFDU==0 & final$MFDU==0 & final$GQDU==0,]$Bzone
zero_rows_2
setdiff(final$Bzone, base$Geo)
dim(base)
dim(final)
setdiff(base$Bzone, final$Geo)
final$Geo==final$Bzone
base
final
setdiff(base$Geo, final$Geo)
setdiff(final$Geo, base$Geo)
final[final$Geo==4911,]
final[final$Geo==5151,]
final[final$Geo==5168,]
dim(base)
#Adding 3 sfdu to rows with 0 units
zero_rows <- input[input$SFDU==0 & input$MFDU==0 & input$GQDU==0,]$Bzone
final$SFDU[Geo==zero_rows,] <- 3
final$SFDU[final$Geo==zero_rows,] <- 3
final[final$Geo==zero_rows]
final[final$Geo in zero_rows]
final[final$Geo %in% zero_rows]
final[final$Geo %in% zero_rows,]
#Adding 3 sfdu to rows with 0 units
zero_rows <- final[final$SFDU==0 & final$MFDU==0 & final$GQDU==0,]$Geo
zero_rows
#Adding 3 sfdu to rows with 0 units
zero_rows <- final[final$SFDU==0 & final$MFDU==0 & final$GQDU==0,]$Geo
final$SFDU[final$Geo %in% zero_rows,] <- 3
final$SFDU[final$SFDU==0 & final$MFDU==0 & final$GQDU==0,] <- 3
final$SFDU[final$SFDU==0 & final$MFDU==0 & final$GQDU==0] <- 3
final[final$SFDU==0 & final$MFDU==0 & final$GQDU==0]
final
final$Geo[final$SFDU==0 & final$MFDU==0 & final$GQDU==0,]
new_rows=final$Geo[final$SFDU==0 & final$MFDU==0 & final$GQDU==0,]
final[final$Geo==5168,]
setdiff(final$Geo, base$Geo)
input <- read.csv('bzone_dwelling_units_2045.csv')
base <- read.csv('../models/HGAC-RSPM-TAZ/inputs/bzone_dwelling_units.csv')[base$Year==2019,]
increase_file <- read.csv('Bzone1aGalReloTAZs.csv')
decrease_file <- read.csv('GalvestonIsland1aDwellingUnits.csv')
taz_groupings <- read.csv('TOE_TAZ-BZONE.csv')
decrease_factor= 0.2
increase_list <- increase_file$NewTAZ_ID
decrease_list <- decrease_file$NewTAZ_ID
decrease_rows <- input$Geo %in% decrease_list
changes <- lapply(input[decrease_rows,c("SFDU","MFDU","GQDU")],function(x) decrease_factor*sum(x))
total_change_sf = changes$SFDU
total_change_mf = changes$MFDU
total_change_gq = changes$GQDU
increase_rows <- input$Geo %in% increase_list
initial <- lapply(input[increase_rows,c("SFDU","MFDU","GQDU")],sum)
increase_factor <- mapply(function(change,initial) change/initial, changes, initial)
increase_factor[increase_factor == Inf] = 0 # Replace any Inf with zero in the increase factor
# increase_factor is then a list with elements c("SFDU","MFDU","GQDU") each of which is the corresponding factor
increase_factor <- as.data.frame(t(increase_factor))
input$SFDU[increase_rows] <- (1-increase_factor$SFDU)*input$SFDU[increase_rows]
input$MFDU[increase_rows] <- (1-increase_factor$MFDU)*input$MFDU[increase_rows]
input$GQDU[increase_rows] <- (1-increase_factor$GQDU)*input$GQDU[increase_rows]
input$SFDU[decrease_rows] <- (1-decrease_factor)*input$SFDU[decrease_rows]
input$MFDU[decrease_rows] <- (1-decrease_factor)*input$MFDU[decrease_rows]
input$GQDU[decrease_rows] <- (1-decrease_factor)*input$GQDU[decrease_rows]
input$Bzone <- taz_groupings$Bzone
#aggregates input into dataframe
final <- aggregate(input[,c("Year","SFDU","MFDU","GQDU")],by=list(Geo=taz_groupings$Bzone),sum)
#Adding 3 sfdu to rows with 0 units
final$SFDU[final$SFDU==0 & final$MFDU==0 & final$GQDU==0] <- 3
setdiff(final$Geo, base$Geo)
dim(final)==dim(base)
setdiff(final$Geo, base$Geo)
zero_rows <- final[sum(final$SFDU+final$MFDU+final$GQDU)==0]$Geo
zero_rows
setdiff(base$Geo, final$Geo)
setdiff(final$Geo, base$Geo)
input
input <- read.csv('../models/HGAC-RSPM-TAZ/inputs/bzone_dwelling_units.csv')[base$Year==2045,]
base <- read.csv('../models/HGAC-RSPM-TAZ/inputs/bzone_dwelling_units.csv')[base$Year==2019,]
increase_file <- read.csv('Bzone1aGalReloTAZs.csv')
decrease_file <- read.csv('GalvestonIsland1aDwellingUnits.csv')
taz_groupings <- read.csv('TOE_TAZ-BZONE.csv')
decrease_factor= 0.2
increase_list <- increase_file$NewTAZ_ID
decrease_list <- decrease_file$NewTAZ_ID
decrease_rows <- input$Geo %in% decrease_list
changes <- lapply(input[decrease_rows,c("SFDU","MFDU","GQDU")],function(x) decrease_factor*sum(x))
total_change_sf = changes$SFDU
total_change_mf = changes$MFDU
total_change_gq = changes$GQDU
increase_rows <- input$Geo %in% increase_list
initial <- lapply(input[increase_rows,c("SFDU","MFDU","GQDU")],sum)
increase_factor <- mapply(function(change,initial) change/initial, changes, initial)
increase_factor[increase_factor == Inf] = 0 # Replace any Inf with zero in the increase factor
# increase_factor is then a list with elements c("SFDU","MFDU","GQDU") each of which is the corresponding factor
increase_factor <- as.data.frame(t(increase_factor))
input$SFDU[increase_rows] <- (1-increase_factor$SFDU)*input$SFDU[increase_rows]
input$MFDU[increase_rows] <- (1-increase_factor$MFDU)*input$MFDU[increase_rows]
input$GQDU[increase_rows] <- (1-increase_factor$GQDU)*input$GQDU[increase_rows]
input$SFDU[decrease_rows] <- (1-decrease_factor)*input$SFDU[decrease_rows]
input$MFDU[decrease_rows] <- (1-decrease_factor)*input$MFDU[decrease_rows]
input$GQDU[decrease_rows] <- (1-decrease_factor)*input$GQDU[decrease_rows]
input$Bzone <- taz_groupings$Bzone
input
#aggregates input into dataframe
final <- aggregate(input[,c("Year","SFDU","MFDU","GQDU")],by=list(Geo=taz_groupings$Bzone),sum)
#Adding 3 sfdu to rows with 0 units
final$SFDU[final$SFDU==0 & final$MFDU==0 & final$GQDU==0] <- 3
input
View(final)
View(final)
input <- read.csv('../models/HGAC-RSPM-TAZ/inputs/bzone_dwelling_units.csv')[base$Year==2045,]
base <- read.csv('../models/HGAC-RSPM-TAZ/inputs/bzone_dwelling_units.csv')[base$Year==2019,]
increase_file <- read.csv('Bzone1aGalReloTAZs.csv')
decrease_file <- read.csv('GalvestonIsland1aDwellingUnits.csv')
taz_groupings <- read.csv('TOE_TAZ-BZONE.csv')
decrease_factor= 0.2
increase_list <- increase_file$NewTAZ_ID
decrease_list <- decrease_file$NewTAZ_ID
decrease_rows <- input$Geo %in% decrease_list
changes <- lapply(input[decrease_rows,c("SFDU","MFDU","GQDU")],function(x) decrease_factor*sum(x))
total_change_sf = changes$SFDU
total_change_mf = changes$MFDU
total_change_gq = changes$GQDU
increase_rows <- input$Geo %in% increase_list
initial <- lapply(input[increase_rows,c("SFDU","MFDU","GQDU")],sum)
increase_factor <- mapply(function(change,initial) change/initial, changes, initial)
increase_factor[increase_factor == Inf] = 0 # Replace any Inf with zero in the increase factor
# increase_factor is then a list with elements c("SFDU","MFDU","GQDU") each of which is the corresponding factor
increase_factor <- as.data.frame(t(increase_factor))
input$SFDU[increase_rows] <- (1-increase_factor$SFDU)*input$SFDU[increase_rows]
input$MFDU[increase_rows] <- (1-increase_factor$MFDU)*input$MFDU[increase_rows]
input$GQDU[increase_rows] <- (1-increase_factor$GQDU)*input$GQDU[increase_rows]
input$SFDU[decrease_rows] <- (1-decrease_factor)*input$SFDU[decrease_rows]
input$MFDU[decrease_rows] <- (1-decrease_factor)*input$MFDU[decrease_rows]
input$GQDU[decrease_rows] <- (1-decrease_factor)*input$GQDU[decrease_rows]
input$Bzone <- taz_groupings$Bzone
