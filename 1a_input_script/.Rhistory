library(readxl)
X1c <- read_excel("~/Houston Results/1c.csv")
View(X1c)
`1c` <- read.csv("~/Houston Results/1c.csv", row.names=1)
View(`1c`)
View(`1c`)
View(`1c`)
View(`1c`)
View(`1c`)
View(`1c`)
remove('1c')
library(readxl)
X1c <- read_excel("~/Houston Results/1c.xlsx")
View(X1c)
remove('X1c')
library(dplyr)
print(final)
library(dplyr)
#importing csvs
dwellings <- read.csv('bzone_dwelling_units_2045.csv')
increase_file <- read.csv('Bzone1aGalReloTAZs.csv')
decrease_file <- read.csv('GalvestonIsland1aDwellingUnits.csv')
taz_groupings <- read.csv('TOE_TAZ-BZONE.csv')
#creates lists of zones to increase/decrease
increase_list=increase_file$NewTAZ_ID
decrease_list=decrease_file$NewTAZ_ID
#define factor by which to decrease
decrease_factor=.2
#calculate number of dwellings which change location
decrease_dwellings=dwellings %>% filter(Geo %in% decrease_list)
total_change_sf=decrease_factor*sum(decrease_dwellings$SFDU)
total_change_mf=decrease_factor*sum(decrease_dwellings$MFDU)
total_change_gq=decrease_factor*sum(decrease_dwellings$GQDU)
#calculate initial total dwellings in increase zones
increase_dwellings=dwellings %>% filter(Geo %in% increase_list)
sf_initial=sum(increase_dwellings$SFDU)
mf_initial=sum(increase_dwellings$MFDU)
gq_initial=sum(increase_dwellings$GQDU)
#calculate factor to increase by
sf_increase_factor=total_change_sf/sf_initial
mf_increase_factor=total_change_mf/mf_initial
gq_increase_factor=total_change_gq/gq_initial
#replacing values based on increase/decrease factors
dwellings$SFDU <- ifelse(dwellings$Geo %in% increase_list, (1-sf_increase_factor)*dwellings$SFDU, dwellings$SFDU)
dwellings$MFDU <- ifelse(dwellings$Geo %in% increase_list, (1-mf_increase_factor)*dwellings$MFDU, dwellings$MFDU)
dwellings$GQDU <- ifelse(dwellings$Geo %in% increase_list, (1-gq_increase_factor)*dwellings$GQDU, dwellings$GQDU)
dwellings$SFDU <- ifelse(dwellings$Geo %in% decrease_list, (1-decrease_factor)*dwellings$SFDU, dwellings$SFDU)
dwellings$MFDU <- ifelse(dwellings$Geo %in% decrease_list, (1-decrease_factor)*dwellings$MFDU, dwellings$MFDU)
dwellings$GQDU <- ifelse(dwellings$Geo %in% decrease_list, (1-decrease_factor)*dwellings$GQDU, dwellings$GQDU)
#adding bzone numbers, then compresssing tazs by bzone
dwellings$Bzone <- taz_groupings$Bzone
final <- dwellings %>%
group_by(Bzone) %>%
summarize(across(c(SFDU,MFDU,GQDU),sum))
#adding dwellings to 0-dwelling bzones
final$SFDU <- ifelse(final$SFDU+final$MFDU+final$GQDU)
#adding dwellings to 0-dwelling bzones
final$SFDU <- ifelse(final$SFDU+final$MFDU+final$GQDU==0, 5, 0)
#exporting and saving to csv
write.csv(final, "1a_bzone_dwelling_units.csv", row.names=FALSE)
print(final[169])
print(final[:169])
print(final)
print(final,n=25)
0+0
0+0==0
print(final)
input <- read.csv('bzone_dwelling_units_2045.csv')
increase_file <- read.csv('Bzone1aGalReloTAZs.csv')
decrease_file <- read.csv('GalvestonIsland1aDwellingUnits.csv')
taz_groupings <- read.csv('TOE_TAZ-BZONE.csv')
decrease_factor=.2
increase_list<-increase_file$NewTAZ_ID
decrease_list<-decrease_file$NewTAZ_ID
decrease_rows <- input$Geo %in% decrease_list
changes <- lapply(input[decrease_rows,c("SFDU","MFDU","GQDU")],function(x) decrease_factor*sum(x))
total_change_sf=changes$SFDU
total_change_mf=changes$MFDU
total_change_gq=changes$GQDU
increase_rows <- input$Geo %in% increase_list
initial <- lapply(input[increase_rows,c("SFDU","MFDU","GQDU")],sum)
increase_factor <- mapply(function(change,initial) change/initial, changes, initial)
# Changing dwelling units in increase_rows and decrease_rows lists
print(increase_factor)
input$SFDU[increase_rows] <- (1-increase_factor$SFDU)*input$SFDU[increase_rows]
increase_factor[increase_factor == Inf] = 0 # Replace any Ihf with zero in the increase factor
increase_factor
input <- read.csv('bzone_dwelling_units_2045.csv')
increase_file <- read.csv('Bzone1aGalReloTAZs.csv')
decrease_file <- read.csv('GalvestonIsland1aDwellingUnits.csv')
taz_groupings <- read.csv('TOE_TAZ-BZONE.csv')
decrease_factor=.2
increase_list<-increase_file$NewTAZ_ID
decrease_list<-decrease_file$NewTAZ_ID
decrease_rows <- input$Geo %in% decrease_list
changes <- lapply(input[decrease_rows,c("SFDU","MFDU","GQDU")],function(x) decrease_factor*sum(x))
total_change_sf=changes$SFDU
total_change_mf=changes$MFDU
total_change_gq=changes$GQDU
increase_rows <- input$Geo %in% increase_list
initial <- lapply(input[increase_rows,c("SFDU","MFDU","GQDU")],sum)
increase_factor <- mapply(function(change,initial) change/initial, changes, initial)
increase_factor[increase_factor == Inf] = 0 # Replace any Inf with zero in the increase factor
# Changing dwelling units in increase_rows and decrease_rows lists
print(increase_factor)
input$SFDU[increase_rows] <- (1-increase_factor$SFDU)*input$SFDU[increase_rows]
print(input)
input$SFDU
input$MFDU
input$GQDU
increase_rows
input$GQDU[increase_rows]
increase_factor$GQDU
increase_factor
class(increase_factor)
# increase_factor is then a list with elements c("SFDU","MFDU","GQDU") each of which is the corresponding factor
increase_factor <- as.data.frame(increase_factor)
class(increase_factor)
increase_factor$GQDU
increase_factor
input <- read.csv('bzone_dwelling_units_2045.csv')
increase_file <- read.csv('Bzone1aGalReloTAZs.csv')
decrease_file <- read.csv('GalvestonIsland1aDwellingUnits.csv')
taz_groupings <- read.csv('TOE_TAZ-BZONE.csv')
decrease_factor=.2
increase_list<-increase_file$NewTAZ_ID
decrease_list<-decrease_file$NewTAZ_ID
# identify Bzones in which to decrease dwelling units
# apply decrease factor to determine total change in Bzones with decrease dwelling units
decrease_rows <- input$Geo %in% decrease_list
changes <- lapply(input[decrease_rows,c("SFDU","MFDU","GQDU")],function(x) decrease_factor*sum(x))
total_change_sf=changes$SFDU
total_change_mf=changes$MFDU
total_change_gq=changes$GQDU
increase_rows <- input$Geo %in% increase_list
initial <- lapply(input[increase_rows,c("SFDU","MFDU","GQDU")],sum)
increase_factor <- mapply(function(change,initial) change/initial, changes, initial)
increase_factor[increase_factor == Inf] = 0 # Replace any Inf with zero in the increase factor
# increase_factor is then a list with elements c("SFDU","MFDU","GQDU") each of which is the corresponding factor
increase_factor <- as.data.frame(t(increase_factor))
increase_factor
# Changing dwelling units in increase_rows and decrease_rows lists
print(increase_factor)
print(input)
input$SFDU[increase_rows] <- (1-increase_factor$SFDU)*input$SFDU[increase_rows]
input$MFDU[increase_rows] <- (1-increase_factor$MFDU)*input$MFDU[increase_rows]
input$GQDU[increase_rows] <- (1-increase_factor$GQDU)*input$GQDU[increase_rows]
input$SFDU[decrease_rows] <- (1-decrease_factor)*input$SFDU[decrease_rows]
input$MFDU[decrease_rows] <- (1-decrease_factor)*input$MFDU[decrease_rows]
input$GQDU[decrease_rows] <- (1-decrease_factor)*input$GQDU[decrease_rows]
input$Bzone <- taz_groupings$Bzone
#aggregates input into dataframe
final <- aggregate(input[,c("SFDU","MFDU","GQDU")],by=list(Geo=taz_groupings$Bzone),sum)
#Adding 3 sfdu to rows with 0 units
zero_rows <- input[sum(input$SFDU+input$MFDU+input$GQDU)==0]$Bzone
final$SFDU[zero_rows] <- 3
#prints output: run to view dataframe before exporting
print(final)
#exports final output to csv file
write.csv(final, "1a_bzone_dwelling_units.csv", row.names=FALSE)
